<!-- 580be231-740c-4dde-bd17-21a79309f0e0 f0741aaa-d523-4ba6-aa75-303587e09b5d -->
# Curriculum Data and Supervisor Management

## Scope

- Store Software Engineering curriculum as structured data (not images): courses, credits, theory/practical hours, course codes, categories, and prerequisite relations.
- Build supervisor-only UI to create/update/delete curriculum items and validate prerequisite graphs.
- Provide CSV import/export to speed entry from the tables you have.
- Seed an initial scenario: creates a supervisor user and inserts the provided study plan as if that supervisor added it.

## Data Model (essential)

- `Program` (e.g., Software Engineering): id, name, version/year, notes.
- `Course`: id, code, name_en, name_ar, credits, theory_hours, practical_hours, category (UR/CUR/FR/CFR/EFR/Division etc.), semester_hint, remarks.
- `Prerequisite`: id, course_id, prerequisite_course_id, type (all/any), min_grade(optional).
- `StudyPlanItem`: id, program_id, course_id, order_index, group_label (for elective buckets), is_elective, min_select(optional), max_select(optional).
- `AuditLog`: id, actor_id, action, entity, entity_id, diff, created_at.
- `User`: ensure `role` has `SUPERVISOR` with granular permissions.

## Backend

- Migrations to create tables and indexes: `(course_id, prerequisite_course_id)` unique, cascade deletes blocked if referenced.
- Services:
- CourseService: CRUD, search by code/name, bulk upsert, soft-delete.
- StudyPlanService: manage program’s plan items, compute totals, validate graph (DAG) for cycles.
- PrereqService: add/remove prerequisite edges; check missing nodes; export adjacency list.
- Validation rules:
- No cycles in prerequisites.
- Credits and hours are non-negative; course codes unique per program.
- Elective groups track min/max selections.
- REST endpoints (or GraphQL types) under `/api/supervisor/*`:
- Courses: list/create/update/delete, bulk-import, export.
- StudyPlan: get program plan, upsert items, set elective groups.
- Prerequisites: list for course, set-all for course, validate.
- Utilities: validate full program, compute totals by category.
- Seed script: creates `SUPERVISOR` user, `Program: Software Engineering (2016/updated)`, inserts courses and prerequisites per provided tables, attributing `created_by` to supervisor.

## Frontend (Supervisor UI)

- Route `/#/supervisor/curriculum` with tabs:
1) Courses: table with inline edit; bulk CSV import; export.
2) Study Plan: drag-and-drop planner by semester/category, shows totals and warnings.
3) Prerequisites: graph view (force-directed) + side panel checklist to set prereqs; cycle/highlight errors.
4) Validation & Publish: run checks, preview read-only student view, publish/unpublish plan.
- Student/Tester read-only pages:
- Browse curriculum by category/semester.
- View course sheet with prerequisites and dependent courses.

## Import/Export

- CSV columns: `code,name_en,name_ar,credits,theory_hours,practical_hours,category,semester_hint,prereq_codes` (semicolon separated).
- Export mirrors the same to ease round-trips.

## Permissions

- Only `SUPERVISOR` can mutate curriculum; others read-only.
- All writes captured in `AuditLog`.

## Seed Scenario

- Script logs: "Supervisor X created program and imported study plan." Timestamped to now.
- Optionally attach the table images as file attachments to the program record for provenance.

## Testing

- Unit: prerequisite cycle detection, total calculators, CSV parser.
- Integration: import → validate → publish → read-only view works.
- E2E: supervisor creates a course, adds prerequisites, sees validation warnings disappear.

## Deliverables

- Migrations, models, services, API routes.
- Supervisor UI pages and components.
- CSV templates and seed data file.
- Seed script creating the supervisor and the study plan.
- Minimal docs in `docs/curriculum.md`.

### To-dos

- [ ] Add migrations for Program, Course, Prerequisite, StudyPlanItem, AuditLog
- [ ] Implement Course, StudyPlan, Prereq services with validation and totals
- [ ] Expose supervisor-only REST endpoints for CRUD, import/export, validate
- [ ] Implement CSV parser/validator and exporters; provide template
- [ ] Create seed for supervisor user and Software Engineering study plan
- [ ] Build supervisor curriculum UI tabs (Courses, Plan, Prereqs, Validate)
- [ ] Add read-only curriculum browsing for students/testers
- [ ] Write unit/integration/E2E tests for flows and validations
- [ ] Write docs in docs/curriculum.md with data model and CSV spec